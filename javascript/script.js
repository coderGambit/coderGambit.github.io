var backgroundCTX,forgroundCTX,enemyCTX,groundCTX,backgroundAudio,jumpAudio,gameOverAudio,enemyCollisionAudio,musicCheckbox,sfxCheckbox,sfxOn,musicOn,timeElement,scoreElement,gameOverScoreElement,timeInterval,isGameOver,playerCharacter,flyManImageSparite,wingManImageSparite,spikeManImageSparite,groundImageSparite,score=0,totalTime=0,playerSpriteWidth=120,playrSpriteHeight=207,playerSpriteTotalWidth=120,playerSpriteTotalHeight=1242,NAME_FLYMAN="Fly Man",flyManSpriteWidth=122,flyManSpriteHeight=139,flyManSpriteTotalHeight=139,flyManSpriteTotalWidth=244,NAME_WINGMAN="Wing Man",wingManSpriteWidth=216,wingManSpriteHeight=150,wingManTotalSpriteWidth=216,wingManTotalSpriteHeight=750,NAME_SPIKEMAN="Spike Man",spikeManSpriteWidth=120,spikeManSpriteHeight=159,spikeManTotalSpriteWidth=240,spikeManTotalSpriteHeight=477,enemyArr=[],newEnemyIteration=600,currentIteration=0,ground=[],groundSpriteWidth=380,groundSpriteHeight=254,groundTotalSpriteWidth=groundSpriteWidth,groundTotalSpriteHeight=4*groundSpriteHeight;function getRandomArbitrary(e,n){return Math.random()*(n-e)+e}function getRandomInt(e,n){return Math.floor(Math.random()*(n-e+1))+e}function getLandSartingPoint(e){return e.drawnHeight*(159/254)}function setPlayerCharacter(e){var n=ground[0];!playerCharacter&&(playerCharacter=getPlayerCharacter());var r=n.y+getLandSartingPoint(ground[0])-playerCharacter.drawnHeight;playerCharacter.img.complete?playerCharacter.initialState(e,r,forgroundCTX):playerCharacter.img.onload=function(){playerCharacter.initialState(e,r,forgroundCTX)}}function setupGround(){for(var e=0;e<6;e++){if(0===e)ground[e]=new Ground(3,3);else{var n=getRandomInt(2,4);ground[e]=new Ground(n,n)}ground[e].createSprite(groundImageSparite,null,groundSpriteWidth,groundSpriteHeight,groundTotalSpriteWidth,groundTotalSpriteHeight)}groundLoad(0)}function groundLoad(e){if(0===e)ground[e].img.complete?(ground[e].initialState(groundCTX,0,getRandomInt(0,3),0,getRandomInt(380,800-ground[e].drawnHeight)),setPlayerCharacter(0),groundLoad(e+1)):ground[e].img.onload=function(){ground[e].initialState(groundCTX,0,getRandomInt(0,3),0,getRandomInt(380,800-ground[e].drawnHeight)),setPlayerCharacter(0),groundLoad(e+1)};else{if(e>=ground.length)return;calcNextGroundPosition(e,!0)}}function calcNextGroundPosition(e,n){var r,t=ground[e],a=(r=0===e?ground[ground.length-1]:ground[e-1]).x+r.drawnWidth+getRandomInt(60,180);if(!n){var i=getRandomInt(2,4);t.reCalculateWidthScale(i),t.reCalculateHeightScale(i)}var o=getRandomInt(getYForNextGround(r),t.baseLimit);t.img.complete?t.initialState(groundCTX,0,getRandomInt(0,3),a,o):t.img.onload=function(){t.initialState(groundCTX,0,getRandomInt(0,3),a,o)},n&&groundLoad(e+1)}function getYForNextGround(e){for(var n=e.y-199;n<=380;)++n;return n}function init(){musicCheckbox=document.getElementById("music"),sfxCheckbox=document.getElementById("sfx"),musicOn=musicCheckbox.checked,sfxOn=sfxCheckbox.checked,handleVisibility(),setBackgroundAudio(),setupJumpAudio(),setupEnemyCollisionAudio(),setupGameOverAudio(),document.addEventListener("keydown",monitorKeyDown,!1),document.addEventListener("keyup",monitorKeyUp,!1),backgroundCTX=document.getElementById("backgroundCanvas").getContext("2d"),forgroundCTX=document.getElementById("foregroundCanvas").getContext("2d"),enemyCTX=document.getElementById("enemyCanvas").getContext("2d"),groundCTX=document.getElementById("groundCanvas").getContext("2d"),timeElement=document.getElementById("time"),scoreElement=document.getElementById("score"),gameOverScoreElement=document.getElementById("scoreText"),background=new Background,timeInterval=setInterval(timeCounter,998),(groundImageSparite=new Image).src="./assets/img/Spritesheets/ground.png",setupGround(),playerCharacter=getPlayerCharacter(),addEnemy(null,null,NAME_FLYMAN),addEnemy(null,null,NAME_WINGMAN),animate()}function toggleSFX(){sfxOn=sfxCheckbox.checked}function toggleMusic(){musicOn=musicCheckbox.checked,playBackgroundAudio(),playGameOverAudio()}function addToScore(e){score+=e}function stopTime(){clearInterval(timeInterval),timeElement.innerHTML="Time: ",scoreElement.innerHTML="Score: 0",totalTime=0,score=0}function setTimeInterval(e){timeInterval=setInterval(timeCounter,e)}function gameOver(e){isGameOver=!0,document.getElementById("gameOver").style.display="block",gameOverScoreElement.innerHTML="Your Score "+score+"!",backgroundAudio.pause(),stopTime(),e&&playEnemyCollisionAudio(),playGameOverAudio(),currentIteration=0}function restart(){isGameOver=!1,gameOverAudio.pause(),document.getElementById("gameOver").style.display="none",resetGame(),playBackgroundAudio(),setTimeInterval(998),requestAnimationFrame(animate),background.speed=.75}function resetGame(){setupGround(),playerCharacter.resetPlayer(),resetEnemies(),groundCTX.clearRect(0,0,800,800),enemyCTX.clearRect(0,0,800,800),background.speed=1}function setupGameOverAudio(){!gameOverAudio&&(gameOverAudio=new Audio("./assets/audio/whacked.mp3")),gameOverAudio.loop=!0}function playGameOverAudio(){musicOn&&isGameOver?gameOverAudio.play():gameOverAudio.pause()}function setupEnemyCollisionAudio(){!enemyCollisionAudio&&(enemyCollisionAudio=new Audio("./assets/audio/threeTone1.mp3"))}function playEnemyCollisionAudio(){sfxOn&&enemyCollisionAudio.play()}function playJumpSound(){sfxOn&&!isGameOver&&((jumpAudio||setupJumpAudio())&&jumpAudio.play())}function setupJumpAudio(){return jumpAudio||(jumpAudio=new Audio("./assets/audio/phaseJump1.mp3"))}function setBackgroundAudio(){!backgroundAudio&&(backgroundAudio=new Audio("./assets/audio/background_music.mp3")),backgroundAudio.loop=!0,playBackgroundAudio()}function playBackgroundAudio(){musicOn&&!isGameOver?backgroundAudio.paused&&backgroundAudio.play():backgroundAudio.pause()}function handleVisibility(){document.addEventListener("visibilitychange",(function(){document.hidden?backgroundAudio.pause():playBackgroundAudio()}))}function addEnemy(e,n,r){switch(r){case NAME_FLYMAN:enemyArr[enemyArr.length]=getFlyMan(e,n);break;case NAME_WINGMAN:enemyArr[enemyArr.length]=getWingMan(e,n);break;case NAME_SPIKEMAN:enemyArr[enemyArr.length]=getSpikeMan(e,n)}}function resetEnemies(){enemyArr.splice(0,enemyArr.length),addEnemy(null,null,NAME_FLYMAN),addEnemy(null,null,NAME_WINGMAN)}function getPlayerCharacter(){return playerCharacter instanceof PlayerSprite?playerCharacter:new PlayerSprite(3,3).createSprite(null,"./assets/img/Spritesheets/player.png",playerSpriteWidth,playrSpriteHeight,playerSpriteTotalWidth,playerSpriteTotalHeight)}function getFlyMan(e,n){var r;return(r=e&&n?new FlyMan(e,n):new FlyMan(3,3)).createSprite(null,"./assets/img/Spritesheets/flyMan.png",flyManSpriteWidth,flyManSpriteHeight,flyManSpriteTotalWidth,flyManSpriteTotalHeight),r.img.onload=function(){r.initialState(enemyCTX)},r}function getWingMan(e,n){var r;return(r=e&&n?new WingMan(e,n):new WingMan(3,3)).createSprite(null,"./assets/img/Spritesheets/wingMan.png",wingManSpriteWidth,wingManSpriteHeight,wingManTotalSpriteWidth,wingManTotalSpriteHeight),r.img.onload=function(){r.initialState(enemyCTX)},r}function getSpikeMan(e,n){return spikeMan,spikeMan=e&&n?new SpikeMan(e,n):new SpikeMan(3,3),spikeMan.createSprite(null,"./assets/img/Spritesheets/spikeMan.png",spikeManSpriteWidth,spikeManSpriteHeight,spikeManTotalSpriteWidth,spikeManTotalSpriteHeight),spikeMan.img.onload=function(){spikeMan.initialState(enemyCTX)},spikeMan}function timeCounter(){timeElement.innerHTML="Time: "+getFormattedTime(++totalTime),score++,scoreElement.innerHTML="Score: "+score}function getGroundCoordinates(){for(var e=[],n=[],r=[],t=[],a=[e,n,r,t],i=0;i<ground.length;i++)ground[i].x+ground[i].drawnWidth>=0&&ground[i].x<=800-playerCharacter.drawnWidth/2&&(e[i]=ground[i].x,n[i]=ground[i].y,r[i]=ground[i].drawnWidth,t[i]=ground[i].drawnHeight);return a}function onLand(e,n){for(var r=!1,t=getGroundCoordinates(),a=playerCharacter.drawnWidth/2,i=0;i<t[0].length;i++){var o=t[0][i],d=t[1][i],u=t[2][i],g=t[3][i];if(e>=o-a&&e<=o+u-a){var m=d+Math.floor(g*(159/254))-playerCharacter.drawnHeight;if(n>=m&&n<=m+1){r=!0;break}}}return r}function getLandY(e,n){for(var r=void 0,t=getGroundCoordinates(),a=playerCharacter.drawnWidth/2,i=0;i<t[0].length;i++){var o=t[0][i],d=t[1][i],u=t[2][i],g=t[3][i];if(e>=o-a&&e<=o+u-a){var m=d+g*(159/254)-playerCharacter.drawnHeight;if(m>=n){r=m;break}}}return r}function getFormattedTime(e){var n=e%60,r=Math.floor(e/60)%60;return r>=1?r/1+"m "+n+"s":n+"s"}function getTime(){return totalTime}function Background(){this.backgroundImage=new Image,this.backgroundImage.src="./assets/img/PNG/Background/bg1.png",this.speed=.75,this.x=0,this.y=0}function animate(){isGameOver||(checkForCollision(),background.render(),movePlayer(),moveGround(),moveEnemy(),intensify(),requestAnimationFrame(animate))}function intensify(){if(currentIteration++>newEnemyIteration){var e=getRandomInt(2,3);addEnemy(e,e,Math.random()>.5?NAME_WINGMAN:NAME_FLYMAN),currentIteration=0}background.speed+=1e-4*background.speed;for(var n=0;n<ground.length;n++)ground[n].speed+=1e-4*ground[n].speed}function getLandSpeed(){return ground[0]?ground[0].speed:1}function checkForCollision(){for(var e,n=0;n<enemyArr.length;n++)if(e=playerCharacter.top>=enemyArr[n].top&&playerCharacter.top<=enemyArr[n].bottom||playerCharacter.bottom<=enemyArr[n].bottom&&playerCharacter.bottom>=enemyArr[n].top,(playerCharacter.left>=enemyArr[n].left&&playerCharacter.left<=enemyArr[n].right||playerCharacter.right<=enemyArr[n].right&&playerCharacter.right>=enemyArr[n].left)&&e){gameOver(!0);break}}function movePlayer(){playerCharacter.isLoaded&&(playerCharacter.move(forgroundCTX),playerCharacter.drawSprite(playerCharacter.currentColumn,playerCharacter.currentRow,playerCharacter.x,playerCharacter.y,forgroundCTX))}function moveEnemy(){for(var e=0;e<enemyArr.length;e++)enemyArr[e].animationFinished?enemyLoaded(e)&&enemyArr[e].initialState(enemyCTX):enemyLoaded(e)&&enemyArr[e].move();if(enemyLoaded()){enemyCTX.clearRect(0,0,800,800);for(e=0;e<enemyArr.length;e++)if(enemyLoaded(e)){var n=enemyArr[e];n.switchImage(),n.drawSprite(n.currentColumn,n.currentRow,n.x,n.y,enemyCTX)}}}function enemyLoaded(e){return void 0===e||isNaN(e)?enemyArr[0].isLoaded||enemyArr[1].isLoaded:enemyArr[e].isLoaded}function moveGround(){groundLoaded()&&groundCTX.clearRect(0,0,800,800);for(var e=0;e<ground.length;e++)ground[e].animationFinished?groundLoaded(e)&&calcNextGroundPosition(e,!1):groundLoaded(e)&&ground[e].move(groundCTX)}function groundLoaded(e){return void 0===e||isNaN(e)?ground[0].isLoaded||ground[1].isLoaded||ground[2].isLoaded||ground[3].isLoaded||ground[4].isLoaded||ground[5].isLoaded:ground[e].isLoaded}function monitorKeyDown(e){KEY.onKeyDown(e)}function monitorKeyUp(e){KEY.onKeyUp(e)}Background.prototype.drawBackground=function(){this.x-=this.speed,backgroundCTX.drawImage(this.backgroundImage,this.x,this.y),backgroundCTX.drawImage(this.backgroundImage,this.x+this.backgroundImage.width,this.y),this.x<=-this.backgroundImage.width&&(this.x=0)},Background.prototype.render=function(){backgroundCTX.save(),backgroundCTX.clearRect(0,0,this.backgroundImage.width,this.backgroundImage.height),this.drawBackground(),backgroundCTX.restore()},onload=init;var KEY={pressed:{},LEFT:37,LEFT_Z_BUTTON:90,RIGHT:39,RIGHT_X_BUTTON:88,JUMP:32,JUMP_UP:38,RUN:66,isDown:function(e){return this.pressed[e]},onKeyDown:function(e){var n=e.keyCode;n!==this.LEFT&&n!==this.RIGHT&&n!==this.LEFT_Z_BUTTON&&n!==this.RIGHT_X_BUTTON&&n!==this.JUMP&&n!==this.JUMP_UP&&n!==this.RUN||(this.pressed[n]=!0)},onKeyUp:function(e){var n=e.keyCode;n!==this.LEFT&&n!==this.RIGHT&&n!==this.LEFT_Z_BUTTON&&n!==this.RIGHT_X_BUTTON&&n!==this.JUMP&&n!==this.JUMP_UP&&n!==this.RUN||(this.pressed[n]=!1)}};
//# sourceMappingURL=script.js.map
